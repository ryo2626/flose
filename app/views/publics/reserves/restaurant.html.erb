<h1>レストラン一覧</h1>

<div>
	<h3>空白検索で全ての商品・住所で曖昧検索</h3>
  <%= search_form_for @search, url:publics_restaurant_path do |f| %>
    <%= f.search_field :address_cont, :placeholder => "住所で曖昧検索" %>
    <%= f.submit "検索" %>
  <% end %>
</div>

<div class="row">
	<% @result.each do |r| %>
		<% if r.limit > Time.now and r.quantity > 0 %>
			<div class="col-lg-3 col-xs-6">
				<div class="commodity">
					<div class="row">
						<%= attachment_image_tag r, :commodity_image, :fill, 1000, 1000, fallback: "no_image.png", class: "offset-1 col-10" %>
					</div>
					<h2>商品名: <%= r.commodity_name %></h2>
					<h3>コメント: <%= r.comment %></h3>
					<h4>定価: <%= r.regular_price %>円</h4>
					<h2>販売価格: <%= r.sale_price %>円</h2>
					<h2>残り数: <%= r.quantity %></h2>
        		<% @limit = (r.limit - Time.now).to_i / 60 %>
        		<% @limit_h = @limit /60 %>
        		<% @limit_m = @limit % 60 %>
    			<h2>残り時間: <%= @limit_h %>時間<%= @limit_m %>分
						<%= form_for @reserve, url: publics_reserves_path do |f| %>
							<%= f.hidden_field :commodity_id, :value => r.id %>
							<%= f.hidden_field :public_id, :value => current_public.id %>
							<%= f.submit "予約する", class: "btn btn-danger" %>
						<% end %>
				</div>
			</div>
    <% else %>
    <% end %>
	<% end %>
</div>